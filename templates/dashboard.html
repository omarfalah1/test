{% extends "base.html" %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row g-4 mb-4">
        <div class="col-md-4">
            <div class="card shadow-sm border-0 text-center p-4">
                <div class="mb-2"><i class="fas fa-file-alt fa-2x text-primary"></i></div>
                <h5 class="fw-bold">Total Documents</h5>
                <div class="fs-2 fw-bold" id="total-documents">{{ total_documents }}</div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card shadow-sm border-0 text-center p-4">
                <div class="mb-2"><i class="fas fa-cloud-upload-alt fa-2x text-success"></i></div>
                <h5 class="fw-bold">Uploads This Month</h5>
                <div class="fs-2 fw-bold" id="uploads-this-month">{{ uploads_this_month }}</div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card shadow-sm border-0 text-center p-4">
                <div class="mb-2"><i class="fas fa-layer-group fa-2x text-info"></i></div>
                <h5 class="fw-bold">Total Image Groups</h5>
                <div class="fs-2 fw-bold" id="total-image-groups">{{ total_image_groups }}</div>
            </div>
        </div>
    </div>
    <div class="row g-4">
        <div class="col-lg-6">
            <div class="card shadow-sm border-0 p-4">
                <h6 class="fw-bold mb-3">Document Status Distribution</h6>
                <canvas id="statusPieChart" height="180"></canvas>
            </div>
        </div>
        <div class="col-lg-6">
            <div class="card shadow-sm border-0 p-4">
                <h6 class="fw-bold mb-3">Uploads Per Month</h6>
                <canvas id="uploadsBarChart" height="180"></canvas>
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// Use real data from Flask context
const statusCounts = {{ status_counts | tojson }};
const uploadsPerMonth = {{ uploads_per_month | tojson }};

const statusLabels = Object.keys(statusCounts);
const statusValues = Object.values(statusCounts);
const statusColors = statusLabels.map(label => {
    if (label === 'pending') return '#fbbf24';
    if (label === 'approved') return '#22c55e';
    if (label === 'rejected') return '#ef4444';
    return '#a1a1aa'; // fallback color
});

const monthLabels = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];

window.addEventListener('DOMContentLoaded', function() {
    // Doughnut chart (hollow center)
    new Chart(document.getElementById('statusPieChart'), {
        type: 'doughnut',
        data: {
            labels: statusLabels,
            datasets: [{
                data: statusValues,
                backgroundColor: statusColors,
                borderWidth: 2
            }]
        },
        options: {
            plugins: { legend: { position: 'bottom' } },
            responsive: true,
            cutout: '80%',
        }
    });
    // Bar chart
    new Chart(document.getElementById('uploadsBarChart'), {
        type: 'bar',
        data: {
            labels: monthLabels,
            datasets: [{
                label: "Uploads",
                data: uploadsPerMonth,
                backgroundColor: "#6366f1"
            }]
        },
        options: {
            plugins: { legend: { display: false } },
            responsive: true,
            scales: { y: { beginAtZero: true } }
        }
    });
});
</script>
{% endblock %} 